# ローカルでの動作確認

まずは、作成したアプリケーションがローカルで正しく動作するか確認しましょう。

## 1. 必要なファイルの準備

まず、YOLOv8の学習済みモデルをダウンロードします：

```bash
curl -L https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8s.pt -o yolov8s.pt
```

## 2. Dockerイメージのビルドと実行

ターミナルで以下のコマンドを実行します：

```bash
docker-compose up --build
```

初回実行時は、必要なDockerイメージのダウンロードとビルドに時間がかかります。

## 3. アプリケーションへのアクセス

ブラウザで以下のURLにアクセスします：
```
http://localhost:8501
```

以下の機能が利用可能です：
- 画像のアップロード
- カメラでの撮影
- 検出信頼度の調整
- 検出結果の表示
- 検出物体の統計情報のグラフ表示

# 高火力DOKへのデプロイ

ローカルでの動作確認が完了したら、高火力DOKへのデプロイを行います。

## 1. Dockerイメージのビルドとプッシュ

### Docker Hubへのログイン

```bash
docker login
```

### イメージのビルドとプッシュ

```bash
# イメージのビルド
docker buildx build --platform linux/amd64 -t <あなたのDockerHubユーザー名>/yolo-streamlit:latest .

# Docker Hubにプッシュ
docker push <あなたのDockerHubユーザー名>/yolo-streamlit:latest
```

## 2. 高火力DOKでの設定

### 1. 新しいタスクの作成

1. さくらのクラウドコントロールパネルにログイン
2. 「高火力DOK」を選択
3. 「タスク」タブを選択
4. 「タスクの作成」をクリック

### 2. タスクの設定

以下の項目を設定します：

- **タスク名**: `yolo-streamlit`
- **イメージ**: `<あなたのDockerHubユーザー名>/yolo-streamlit:latest`
- **メモリ**: 2GB以上（推奨）
- **GPU**: 有効
- **外部接続**: 有効
- **ポート**: 8501
- **環境変数**:
  - `PYTORCH_WEIGHTS_ONLY=0`
  - `STREAMLIT_SERVER_ADDRESS=0.0.0.0`
  - `STREAMLIT_SERVER_PORT=8501`

### 3. タスクの起動

設定が完了したら、「作成」をクリックしてタスクを起動します。

## 3. アプリケーションへのアクセス

タスクが起動したら、外部接続URLが表示されます。このURLにブラウザでアクセスすることで、アプリケーションを使用できます。

# トラブルシューティング

## 1. ローカル環境での問題

### カメラが動作しない場合
- ブラウザのカメラアクセス許可を確認
- カメラが正しく接続されているか確認

### 検出が遅い場合
- Dockerのメモリ割り当てを増やす
- 検出信頼度の閾値を調整

## 2. 高火力DOKでの問題

### タスクが起動しない場合
- ログを確認
- メモリ割り当てを増やす
- GPUの設定を確認

### 外部接続ができない場合
- ポート設定を確認
- ファイアウォールの設定を確認

# まとめ

このチュートリアルでは、以下の内容を学びました：

1. YOLOv8を使用した物体検出アプリケーションの作成
2. Streamlitを使用したWebインターフェースの実装
3. Dockerを使用したアプリケーションのコンテナ化
4. 高火力DOKへのデプロイ方法

このアプリケーションをベースに、以下のような拡張が可能です：

- カスタムモデルの使用
- 複数のカメラのサポート
- 検出結果の保存機能
- リアルタイムストリーミング

ぜひ、このチュートリアルを参考に、独自のAIアプリケーション開発に挑戦してみてください！ 